<div class="animated fadeIn" id="chatBox">
  <div style="min-height:75vh;margin-top:0px;padding:0px;border-left: 1px solid #eeeeee; border-right: 1px solid #eeeeee; background-color: white;border-bottom:2px solid #eeeeee " class="container-fluid">
    <div class="container-fluid" style="padding:0px;border-bottom:1px solid #eeeeee;height:110px;">
      <div class="row" style="padding:0px;margin-top:5px">
        <div class="col-md-12">
          <div class="col-md-4" style="padding:0px">
            <div class="btn btn-primary btn-sm btn-block" type="button" name="button" ng-click="knowledgeBase(data.companyPk)"> Knowledge base
            </div>
          </div>
          <div class="col-md-4" style="padding:0px">
            <div class="btn btn-warning btn-sm btn-block" type="button" name="button"  mwl-confirm title="Close Chat" message="Are you sure?" confirm-text="Yes <i class='fa fa-check'></i>" cancel-text="No" on-confirm="chatTransfer(data.uid,data.chatThreadPk)" confirm-button-type="default" cancel-button-type="default"> Chat Transfer
            </div>
          </div>
          <div class="col-md-4" style="padding:0px">
            <div class="btn btn-danger btn-sm btn-block" type="button" name="button"  mwl-confirm title="Close Chat" message="Are you sure?" confirm-text="Yes <i class='fa fa-check'></i>" cancel-text="No" on-confirm="chatClose(index,data.uid,data.chatThreadPk);closed=true" confirm-button-type="default" cancel-button-type="default" ng-hide="closed"> Close Chat
            </div>
            <span ng-if="closed" style="font-size:18px;color:red">Chat Closed</span>
          </div>
        </div>
      </div>
      <div class="row" style="padding:10px;padding-bottom:0px">
        <div class="col-md-8" style="padding-right:0px;" >
          <i class="fa fa-circle" aria-hidden="true" style="color:{{data.isOnline ? '#37a508':'#ff0022'}}"></i> <span style="font-size:18px;" >{{data.uid}}</span>
          <h4 style="margin:5px 10px">{{data.name}}</h4>
        </div>
        <div class="col-md-2">
          <div class="row" style="padding-top:10px;">
            <i ng-if="chatHistBtn" class="fa fa-eye pull-right " aria-hidden="true" style="cursor:pointer; font-size:30px; padding-right:10px;" ng-click="getChatHistory(data.email)" title="Chat History"></i>
          </div>
        </div>
        <div class="col-md-2">
          <div class="row">
            <i class="fa fa-times pull-right " aria-hidden="true" style="cursor:pointer; font-size:20px; padding-right:10px;" ng-click="closeChatBox(index)"></i>
          </div>
          <div class="row" style="padding-top:10px;">
            <i class="fa fa-pencil fa-lg  pull-right" style="cursor:pointer; padding-right:10px;" aria-hidden="true" ng-click="editUserDetails(data.uid)" title="Edit Details"></i>
          </div>
          <!-- <div class="row" style="padding-top:10px;">
            <i ng-if="chatHistBtn" class="fa fa-eye pull-right " aria-hidden="true" style="cursor:pointer; font-size:25px; padding-right:10px;" ng-click="getChatHistory(data.email)" title="Chat History"></i>
          </div> -->
        </div>
        <!-- <div class="col-md-4" style="padding:0px" >
          <div class="btn-group-vertical">
            <button class="btn btn-primary btn-sm" type="button" name="button" ng-click="knowledgeBase(data.companyPk)"> Knowledge base </button>
            <button class="btn btn-warning btn-sm" type="button" name="button"  mwl-confirm title="Close Chat" message="Are you sure?" confirm-text="Yes <i class='fa fa-check'></i>" cancel-text="No" on-confirm="chatClose(data.uid,data.chatThreadPk);closed=true" confirm-button-type="default" cancel-button-type="default" ng-hide="closed"> Chat Transfer </button>
            <button class="btn btn-danger btn-sm" type="button" name="button"  mwl-confirm title="Close Chat" message="Are you sure?" confirm-text="Yes <i class='fa fa-check'></i>" cancel-text="No" on-confirm="chatClose(data.uid,data.chatThreadPk);closed=true" confirm-button-type="default" cancel-button-type="default" ng-hide="closed"> Close Chat </button>
            <span ng-if="closed" style="font-size:22px;color:red">Chat Closed</span>
          </div>
        </div> -->
        <!-- <div class="col-md-2 " >
          <div class="row">
            <i class="fa fa-times pull-right " aria-hidden="true" style="cursor:pointer; font-size:20px; padding-right:10px;" ng-click="closeChatBox(index)"></i>
          </div>
          <div class="row" style="padding-top:10px;">
            <i class="fa fa-pencil fa-lg  pull-right" style="cursor:pointer; padding-right:10px;" aria-hidden="true" ng-click="editUserDetails(data.uid)" title="Edit Details"></i>
          </div>
          <div class="row" style="padding-top:10px;">
            <i ng-if="chatHistBtn" class="fa fa-eye pull-right " aria-hidden="true" style="cursor:pointer; font-size:25px; padding-right:10px;" ng-click="getChatHistory(data.email)" title="Chat History"></i>
          </div>
          <div class="row" style="padding-top:10px;">
            <i class="fa fa-share fa-lg  pull-right" style="cursor:pointer; padding-right:10px;" aria-hidden="true" ng-click="chatTransfer(data.uid)" title="Chat Transfer"></i>
          </div>
        </div> -->
      </div>


  </div>
    <div class="container-fluid" id="scrollArea{{data.uid}}" style="margin-left:10px; height:71vh; overflow-y:auto; overflow-x:hidden;">

      <div class="row" style="padding:0px;" ng-repeat="message in data.messages track by $index">
        <div class="row container-fluid">
          <div style="float:{{message.sentByAgent ? 'right; background-color:#dba4ae; ':'left; background-color:#72b3d4;'}} padding:10px;margin:8px;border-radius:{{message.sentByAgent ? '20px 0px 20px 20px':'0px 20px 20px 20px'}};">
          <p ng-if="message.message.length>0 && message.attachmentType!='youtubeLink'" style="word-break: break-all !important;" > <span ng-if="message.message.includes('www.') || message.message.includes('http')"> <a href="{{message.message}}"> {{message.message}}</a> </span> <span ng-if="!message.message.includes('www.') && !message.message.includes('http')">{{message.message}}</span> </p>
           <img ng-if="message.attachmentType == 'image'" ng-src="{{message.attachment}}" style="width:250px;">
           <video ng-if="message.attachmentType == 'video'" width="280" height="240" ng-src="{{message.attachment}}" controls></video>
           <audio ng-if="message.attachmentType == 'audio'" ng-src="{{message.attachment}}" controls></audio>
           <p class="text-center" ng-if="message.attachmentType == 'application'" style="word-wrap: break-word;"><a ng-href="{{message.attachment}}" target = "_blank" ><i class="fa {{message.attachment.split('chat/')[1] | fileTypeIcon }} fa-2x" ></i></a> <br> {{message.attachment.split('chat/')[1]}}  </p>
           <div ng-if="message.attachmentType == 'youtubeLink'">
             <iframe width="100%" height="215" ng-src="{{message.message | trusted}}" frameborder="0" allowfullscreen></iframe>
           </div>
          </div>

        </div>

        <div class="row container-fluid" style="{{message.sentByAgent ? 'padding-right:30px' : 'padding-left:30px'}};">
          <span ng-if="!message.sentByAgent" style="float:left;  font-size:11px; " class="text-muted" >{{message.created | timeAgo}}</span>
          <span ng-if="message.sentByAgent" style="float:right;  font-size:11px; " class="text-muted" >{{message.user | getName}}, {{message.created | timeAgo}}</span>
        </div>

      </div>
      <span class="text-muted" ng-show="isTyping">Typing... </span>
    </div>
  </div>

  <!-- <div ng-if="emojiOpen" class="row" style="width:200px; height:176px; background-color:#eee; position:absolute; top:61vh;left:150px; padding-top:15px; "  >
    <div style="position:relative" ng-repeat="e in arremoji track by $index">
      <div class="col-md-1">
        <span style="cursor:pointer;" ng-click="insertEmoji($index)" >{{e}}</span>
      </div>
    </div>
  </div> -->

  <div class="" style="padding:;border-top:30px;margin-right:15px">
    <div class="row" style="margin:0px;margin-top:10px;margin-bottom:5px;">
      <form>
        <div class="input-group">
          <input ng-if="chatBox.fileToSend.size==0" type="text" class="form-control" ng-enter="send()" placeholder="Message" ng-model="chatBox.messageToSend">
          <!-- <span ng-if="chatBox.fileToSend.size==0" class="input-group-addon" ng-click="openEmoji()" style="cursor:pointer"><i class="fa fa-smile-o" aria-hidden="true"></i></span> -->
          <input type="file" id="filePickerChat{{index}}" style="display:none;" file-model="chatBox.fileToSend">
          <span ng-if="chatBox.fileToSend.size==0" class="input-group-addon"style="cursor:pointer" ng-click="attachFile()" ><i class="fa fa-paperclip"  aria-hidden="true"></i></span>
          <span ng-if="chatBox.fileToSend.size!=0" class="input-group-addon btn btn-default" > <i class="fa {{chatBox.fileToSend.name | fileTypeIcon }}"></i> </span>
          <span ng-if="chatBox.fileToSend.size!=0" class="input-group-addon btn btn-default" style="font-size:10px;" > {{chatBox.fileToSend.name.slice(0,25)}} </span>
          <span ng-if="chatBox.fileToSend.size!=0" class="input-group-addon btn btn-default" style="cursor:pointer" ng-click="removeFile()" > <i class="fa fa-times" aria-hidden="true"></i> </span>
          <span class="input-group-addon" ng-click="send()" style="cursor:pointer"><i class="fa fa-paper-plane-o" aria-hidden="true"></i></span>
        </div>
      </form>
    </div>
  </div>
</div>
