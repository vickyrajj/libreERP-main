{% load staticfiles%} {% load staticfiles %} {% load socialaccount %}



<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Approval</title>
  {% if useCDN %}
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" charset="utf-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" charset="utf-8"> {% else %}
  <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}" charset="utf-8">

  <link rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}" charset="utf-8"> {% endif %}
  <link rel="stylesheet" href="{% static 'css/signin.css' %}" charset="utf-8">

  <style type="text/css">
    #header{
      background-color: rgb(192, 201, 214);
      color: rgb(15, 15, 15);
      /* border: 1px solid rgb(15, 15, 15) */
    }
    #bodytr{
      text-align: center;
      height:50px
    }
  </style>

</head>

<body>
  <div class="container-fluid">
    <div class="row" style="padding-top:30px">
      <div class="col-md-10 col-md-offset-1">
        <div class="row">
          <h2>Project Details<h2>
        </div>
        <div class="row">
          <strong> Title : </strong> <span id="title"> </span><br /><br />
          <strong> Service : </strong> <span id="service"> </span>
        </div>
        <!-- <div class="row">
          <table cellpadding="2" cellspacing="0" border="0" align="left" width="600" class="container" style="margin-top:20px">
            <tr id="tableHead" height="50" >
              <th width="15%" class="text-center" style="border-right:1px solid rgb(15, 15, 15)"> Part No </th>
              <th width="30%" class="text-center" style="border-right:1px solid rgb(15, 15, 15)"> Product </th>
              <th width="15%" class="text-center" style="border-right:1px solid rgb(15, 15, 15)"> Price </th>
              <th width="15%" class="text-center" style="border-right:1px solid rgb(15, 15, 15)"> Quantity </th>
              <th width="15%" class="text-center" style="border-right:1px solid rgb(15, 15, 15)"> Customer Quantity </th>
            </tr>
            <tr>
              <td width="15%" class="text-center" style="border-right:1px solid rgb(15, 15, 15)" id="part_no"> </td>
              <td width="30%" class="text-center" style="border-right:1px solid rgb(15, 15, 15)" id="product_desc">  </td>
              <td width="15%" class="text-center" style="border-right:1px solid rgb(15, 15, 15)" id="price">  </td>
              <td width="15%" class="text-center" style="border-right:1px solid rgb(15, 15, 15)" id="qty">  </td>
              <td width="15%" class="text-center" style="border-right:1px solid rgb(15, 15, 15)" id="cqty">  </td>
            </tr>
          </table>
        </div> -->
        <div id="myDynamicTable" class="row" style="padding-top:20px">
        </div>
        <div class="row" style="padding-top:20px">
          <div class="col-md-8 text-right">
            <button type="button" class="btn btn-danger pull-right" onclick="reject()" > Reject</button>
            </div>
            <div class="col-md-2 text-right">
            <button type="button" class="btn btn-success pull-right" onclick="approve()">  Approve</button>
          </div>
        </div>
        <div class="row" style="padding-top:20px">
          <div class="col-md-6" id="alerts">
          </div>

        </div>
      </div>
    </div>
  </div>







  {% if useCDN %}
  <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.0/angular.min.js"></script>
  {% else %}
  <script src="{% static 'js/jquery-2.1.4.min.js' %}"></script>
  <script src="{% static 'js/jquery.cookie-1.4.1.min.js' %}"></script>
  <script src="{% static 'js/bootstrap.min.js' %}"></script>
  {% endif %}

  <script type="text/javascript">
    var projects = {{project}}

    function setCookie(cname, cvalue, exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires="+ d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
      }

      function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for(var i = 0; i <ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
      }

      var csrftoken = getCookie("csrftoken")
    function loadDoc() {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          var projectDetail = JSON.parse(this.responseText);
          document.getElementById("title").innerHTML = projectDetail.title
          document.getElementById("service").innerHTML = projectDetail.service.name
        }
      };
      url = '/api/support/projects/' + projects
      xhttp.open("GET", url, true);
      xhttp.send();
    }

    function products() {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          var productDetails = JSON.parse(this.responseText);
          var myTable = document.getElementById("myDynamicTable");
          var table = document.createElement('table');
          table.border = '1';
          var tableBody = document.createElement('tbody');
          table.appendChild(tableBody);
          var tr1 = document.createElement('tr');
          tr1.innerHTML='<th width="15%" class="text-center" style="border-right:1px solid rgb(15, 15, 15)"> Part No </th>\
          <th width="30%" class="text-center" style="border-right:1px solid rgb(15, 15, 15)"> Product </th>\
          <th width="15%" class="text-center" style="border-right:1px solid rgb(15, 15, 15)"> Price </th>\
          <th width="15%" class="text-center" style="border-right:1px solid rgb(15, 15, 15)"> Quantity </th>\
          <th width="15%" class="text-center" style="border-right:1px solid rgb(15, 15, 15)"> Customer Quantity </th>'
          tableBody.appendChild(tr1);
          tr1.setAttribute("id", "header")
          for (var i = 0; i < productDetails.length; i++) {
            var tr = document.createElement('tr');
            tableBody.appendChild(tr);
            var td1 = document.createElement('td');
            var td2 = document.createElement('td');
            var td3 = document.createElement('td');
            var td4 = document.createElement('td');
            var td5 = document.createElement('td');
            td1.width = '20%';
            td2.width = '30%';
            td3.width = '20%';
            td4.width = '20%';
            td5.width = '20%';
            td1.appendChild(document.createTextNode(productDetails[i].products.part_no));
            td2.appendChild(document.createTextNode(productDetails[i].products.description_1));
            td3.appendChild(document.createTextNode(productDetails[i].price));
            td4.appendChild(document.createTextNode(productDetails[i].quantity1));
            td5.appendChild(document.createTextNode(productDetails[i].customer_price));
            tr.appendChild(td1);
            tr.appendChild(td2);
            tr.appendChild(td3);
            tr.appendChild(td4);
            tr.appendChild(td5);
            tr.setAttribute("id", "bodytr")
          }
          myTable.appendChild(table);
        }
      };
      url = '/api/support/bom/?project=' + projects
      xhttp.open("GET", url, true);
      xhttp.send();
    }
    loadDoc()
    products()

    function reject(){
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          document.getElementById('alerts').innerHTML='<div class="alert alert-success">Saved!!</div>'
          location.replace('/')
        }
      };
      var formData = "status=created"
      var status = 'created'
      var formData = "status="+status
      var url = '/api/support/projects/' + projects + '/'
      xhttp.open("PATCH", url,true);
      xhttp.setRequestHeader('X-CSRFToken', csrftoken);
      xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded")
      xhttp.setRequestHeader("Content-length", formData.length);
      xhttp.send(formData);
    }
    function approve(){
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          document.getElementById('alerts').innerHTML='<div class="alert alert-success">Saved!!</div>'
          location.replace('/')
        }
      };
      var formData = "status=created"
      var status = 'approved'
      var formData = "status="+status
      var url = '/api/support/projects/' + projects + '/'
      xhttp.open("PATCH", url,true);
      xhttp.setRequestHeader('X-CSRFToken', csrftoken);
      xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded")
      xhttp.send(formData);
    }
  </script>
</body>

</html>
